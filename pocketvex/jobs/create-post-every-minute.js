//Create Post Every Minute
//Registers a CRON job that creates a new post record every 60 seconds.
//Schedule format (with seconds): second minute hour day month dayOfWeek
//Using '*/60 * * * * *' = every 60 seconds.

$jobs.register('create-post-every-minute', '*/60 * * * * *', async (cron) => {
  const now = new Date();
  const iso = now.toISOString();

  const title = `An awesome automated post @ ${iso}`;
  const content = [
    `This post was generated by a CRON job at ${iso}.`,
    `Job: create-post-every-minute`,
  ].join('\n');

  try {
    // Ensure required fields match your 'posts' collection
    const record = await $app.db().create('posts', {
      title,
      content,
      published: true,
      // Optional: include a valid tag from your select values
      tags: ['tech'],
    });

    console.log('✅ Created automated post:', record?.id || title);
  } catch (error) {
    console.error(
      '❌ Failed to create automated post:',
      error?.message || error,
    );
  }
});

console.log('⏰ CRON job registered: create-post-every-minute (every 60s)');
